---
tags:
  - JWT
  - OAUTH2
---
---
# 1. JWT


- 보장하는것 
	- 서버가 발급한 토큰인지(출처, 위조방지)
	- 내용이 변조되지 않았는지 (무결성)
- 보장하지않는것
	- 기밀성  **( jwt자체는 암호화 되지 않음)**

**토큰탈취에 대한 방지가 필요**
- 민감정보를 payload에 넣지 않는것
- HTTPONLY COOKIE처리
- HTTPS 사용
- ACCESS TOKEN 수명을 짧게
- REFRESH TOKEN 로테이션 고려
- IP/DEVICE 기반 검증


##  Spring 설정처리 
### 설정값 바인딩 클래스 
	properties의 jwt.으로 시작하는 설정값을 바인딩 해줌

![JWT_properties](/첨부파일/JWT_properties.png)
	
![JWT_properties_class](/첨부파일/JWT_properties_class.png)
- 시크릿키
- Access토큰 만료시간
- Refresh토큰 마료시간
- 쿠키설정
	- access_token명
	- refresh_token명
	- 접속 domain 명
	- https 여부
	- samesite (Lax, Strict , None)


![쿠키생성시 설정값사용](/첨부파일/쿠키생성시_설정값사용.png)


## 구조

- header.payload.signature
header : 알고리즘 정보를 담음
payload : 코드상 claim / key ,value형태의 jwt의 본 내용
signature :  서버의 key값으로 서명한 서명값

서명 : header.payload를 병합한 문자열을 서버내 키값으로 암호화한값

위변조여부확인 => header.payload를 서버내 키값으로 암호화한 값과 signature값의 일치여부 확인



## 주요 클래스 및 메서드

**io.jsonwebtoken.Jwts **

- builder() :  jwt생성하기 위한 빌더시작
- claims(Map) : JWT payload설정
- claim(key, value) : payload 하나하나 추가할경우사용
- subject(String) : 주체 설정(인증기준값)
- issuedAt() : 발행일
- expiration() : 만료일
- signWith(SecretKey) :  키값으로 서명
- compact() : JWT문자열 생성
- parser() : 해석(파싱)용 빌더시작
- verifyWith(SecretKey) : Signature재계산 및 서명 비교를위한 키값설정
- parseSignedClaims(토큰) : 해당토큰에 대한 검증 / 파싱처리  => Claims 객체 반환
- getPayload() : claim값들 반환


![토큰생성](/첨부파일/토큰생성.png)
![토큰검증_파싱](/첨부파일/토큰검증_파싱.png)


**io.jsonwebtoken.Claims**
* getSubject() : 주체 반환
* get(key, 타입) : 특정 payload 반환